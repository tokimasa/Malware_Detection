# -*- coding: utf-8 -*-
"""
Created on Mon Mar 19 21:35:02 2018

@author: TOKIMASA
"""
import pandas as pd


from sklearn.ensemble import RandomForestClassifier

dataset_df = pd.read_csv('dataset.csv')

label_df = pd.read_csv('training-set.csv', names=['FileID','Label'], header=None)
trainset = label_df.merge(dataset_df, on='FileID', how='left')
trainset_label = trainset[['Label']]
trainset = trainset[['Customer_Count','Max_Customer_Repeat','Product_Count','Max_Product_Repeat','Night_Ratio']]



label_df_ = pd.read_csv('testing-set.csv', names=['FileID','Label'], header=None)
testset = label_df_.merge(dataset_df, on='FileID', how='left')
test_file_id = testset.FileID
testset = testset[['Customer_Count','Max_Customer_Repeat','Product_Count','Max_Product_Repeat','Night_Ratio']]

clf = RandomForestClassifier(max_depth=5, n_estimators=10, max_features=1, random_state=0)
clf.fit(trainset.as_matrix(), trainset_label.as_matrix())

p = clf.predict_proba(testset.as_matrix())
p_ = pd.DataFrame(p[:,1],columns=['Probability'])

final_df = pd.concat([label_df_, p_], axis=1)[['FileID','Probability']]

final_df.to_csv('final.csv')